---
layout: post
title: jenkins持续集成部署
tags: jenkins
category: jenkins
comments: true
description: Jenkins 自动部署
---

- 下载[jenkins](https://jenkins.io/)最新war包

在`jenkins.war`所在目录执行命令：`java -jar jenkins.war`, 浏览器中访问[http://localhost:8080/](http://localhost:8080/)

- 安装插件

`Maven Integration plugin`、`Deploy to container Plugin`

- 添加新项目

以上步骤
> 参考：[廖雪峰 jenkins持续集成](https://www.liaoxuefeng.com/article/001463233913442cdb2d1bd1b1b42e3b0b29eb1ba736c5e000)

<!--more-->

-----------------
<!--more-->

- 添加构建后操作

![](/assets/img/source/构建后操作.png "构建后操作")

`Manager user name` `Manager password`为tomcat `conf/tomcat-user.xml`中配置的username和password

注意四个角色都要配上, 否则构建部署时会报异常：`The username you provided is not allowed to use the text-based Tomcat Manager (error 403)`.

![](/assets/img/source/tomcat用户配置.png "tomcat用户配置")

-------

**更新 gradle构建**

在启动 Jenkins 时需要添加参数`-Dhudson.util.ProcessTree.disable=true`

`java -Dhudson.util.ProcessTree.disable=true -jar jenkins.war --httpPort=8899 >~/out/jenkins/jenkins"${current_date}".out 2>&1 &'`

1. 在全局工具中添加 gradle
2. 添加构建后 shell 命令

```shell
lsof -ti :9999 | xargs kill -9
current_date=`date +-%Y-%m-%d`

rm -rf /Users/zhuji/jenkins/rigger
cp -r /Users/zhuji/.jenkins/workspace/rigger /Users/zhuji/jenkins/rigger
cd /Users/zhuji/jenkins/rigger
gradle bootRun >>/Users/zhuji/out/rigger/rigger"${current_date}".out 2>&1 &
```